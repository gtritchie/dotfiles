#!/usr/bin/env bash

set -e

echo "About to delete all per-user RStudio state and settings, proceed with caution!"
echo "(Does not delete Project-specific state in .Rproj.user or global machine state)"
read -p "Press [enter] to continue or Ctrl+C"

PLATFORM=`uname`

if [[ -f ~/.RData ]]; then
  rm ~/.RData
fi

if [[ -f ~/.Rhistory ]]; then
  rm ~/.Rhistory
fi

# global options
if [[ -d ~/.config/rstudio ]]; then
  rm -rf ~/.config/rstudio
fi

# settings and session state
if [[ -d ~/.rstudio ]]; then
  rm -rf ~/.rstudio
fi

# open files and tabs
if [[ -d ~/.local/share/rstudio ]]; then
  rm -rf ~/.local/share/rstudio
fi

# desktop state
if [[ -d ~/.rstudio-desktop ]]; then
  rm -rf ~/.rstudio-desktop
fi

if [ "${PLATFORM}" = "Darwin" ]; then
  # macOS desktop settings
  defaults delete com.rstudio.desktop > /dev/null 2>&1 || true
  defaults delete com.RStudio.desktop > /dev/null 2>&1 || true
  defaults delete org.rstudio.RStudio > /dev/null 2>&1 || true
elif [[ -d ~/.config/RStudio ]]; then
  # Linux desktop settings
  rm -rf ~/.config/RStudio
fi

echo Done cleaning RStudio settings and state

