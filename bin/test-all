#!/usr/bin/env bash
#
# Helper for running ide automation interactively
#

set -e

PREV_WD=$(pwd)
cd ~/rstudio-ide-automation/rstudio_server_pro/

# NOTE destructive configuration (on purpose) to get to clean startup state
echo "Cleaning up RStudio Server state (may need sudo password)"
echo "auth-sign-in-throttle-seconds=0" | sudo tee /etc/rstudio/rserver.f > /dev/null
echo '{"terminal_renderer": "dom", "save_workspace": "never"}' | sudo tee /etc/rstudio/rstudio-prefs.json > /dev/null
rm -f ~/"~.Rproj"
rm -rf ~/.rstudio
rm -rf ~/.config

ENV='local' ../scripts/run-tests.sh -m "not devexclude and not rsp"

cd $PREV_WD
